<?phpnamespace App\Rules;use App\Models\LoanInvestment;use App\Models\CommiteePackage;use App\Models\CommiteeInvestment;use App\Models\User;use App\Models\Transaction; use Closure;use Illuminate\Contracts\Validation\ValidationRule;use Illuminate\Support\Facades\Auth;class ValidateLoanPackage implements ValidationRule{    /**     * Run the validation rule.     *     * @param  \Closure(string): \Illuminate\Translation\PotentiallyTranslatedString  $fail     */    public function __construct($request)    {        $this->request = $request;    }    public function validate(string $attribute, mixed $value, Closure $fail): void    {        $request = $this->request;        $check_exists = CommiteePackage::where('id',$this->request->package)->first();        if($check_exists){            $minReq=$check_exists->min;            $maxReq=$check_exists->max;             $multiple=$check_exists->amount;                 # code...                $wallet_type = $this->request->wallet_type;                if($this->request->amount!=''){                    if($this->request->amount<$minReq){                        $fail("Amount Should Be minimum $minReq .");                    }                     if($this->request->amount>$maxReq){                        $fail("Amount Should Be maximum $maxReq .");                    }                    if ($this->request->amount % $multiple != 0) {   // ðŸ‘ˆ multiple check                            $fail("Amount must be in multiples of {$multiple}.");                        }                    if ($request->user()->wallet->$wallet_type<$this->request->amount) {                        $fail('Insufficient Fund in wallet');                    }                                                        }else{                    $fail('Invalid Amount!');                }                          if($check_exists->no_of_time=="once")            {                              if($request->mobile){                    $tx_user = User::where('mobile',$request->mobile)->first();                     if($tx_user){                        $chkinvestmentExists = CommiteeInvestment::where('package_id',$this->request->package)->where('user_id',$tx_user->id)->where('status',1)->first();                                                 if($chkinvestmentExists){                            $fail('You can buy this package only once.');                        }                    }else{                        $fail('User not Exists.');                    }                }else{                    $fail('Enter User.');                }                            }            if($check_exists->pre_reqired==1)            {                   $oid = $check_exists->id;                $pre_id = $oid-1;                if($pre_id>=1){                    $userInvestments = $request->user()->investments;                                        if($request->mobile){                        $tx_user = User::where('mobile',$request->mobile)->first();                        if($tx_user){                            $chkinvestmentExists = CommiteeInvestment::where('package_id',$pre_id)->where('user_id',$tx_user->id)->where('status',1)->first();                            if(!$chkinvestmentExists){                                $fail('Buy Previous Package first');                            }                        }else{                            $fail('User not Exists.');                        }                    }else{                        $fail('Enter User.');                        }                                    }                            }        }else{            $fail('Invalid Package!');        }    }}